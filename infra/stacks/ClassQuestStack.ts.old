import { StackContext, Bucket } from "sst/constructs";
import { createTables } from "./tables";
import { createApi } from "./api";
import { createAuth } from "./auth";

export function ClassQuestStack(ctx: StackContext) {
    const { stack } = ctx;

    const assetsBucket = new Bucket(stack, "Assets");

    const tables = createTables(ctx);

    const { userPool, userPoolClient } = createAuth(ctx, tables.usersTable);

    const api = createApi(stack, tables, userPool);

    stack.addOutputs({
        ApiUrl: api.url,
        Region: stack.region,
        UserPoolId: userPool.userPoolId,
        UserPoolClientId: userPoolClient.userPoolClientId,
        BossQuestionsTableName: tables.bossQuestionsTable.tableName,
        BossBattleTemplatesTableName: tables.bossBattleTemplatesTable.tableName,
    });

    return { assetsBucket, userPool, userPoolClient, ...tables, api };
}
